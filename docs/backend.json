{
  "entities": {
    "Tenant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tenant",
      "type": "object",
      "description": "Represents a tenant within the Whizly AI application. A tenant isolates data for different users or organizations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tenant entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the tenant."
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to User who owns the tenant. (Relationship: User 1:N Tenant)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the tenant was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "ownerId",
        "createdAt"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Whizly AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "tenantId": {
          "type": "string",
          "description": "The ID of the tenant this user belongs to."
        },
        "role": {
          "type": "string",
          "description": "The user's role within the application.",
          "enum": ["Admin", "Manager", "Employee"]
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "tenantId"
      ]
    },
    "Lead": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lead",
      "type": "object",
      "description": "Represents a lead in the CRM system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lead entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant this lead belongs to. (Relationship: Tenant 1:N Lead)"
        },
        "name": {
          "type": "string",
          "description": "The name of the lead."
        },
        "contactInfo": {
          "type": "string",
          "description": "Contact information for the lead."
        },
        "status": {
          "type": "string",
          "description": "The current status of the lead (e.g., new, contacted, qualified)."
        },
        "assignedTo": {
          "type": "string",
          "description": "Reference to User assigned to this lead. (Relationship: User 1:N Lead)"
        }
      },
      "required": [
        "id",
        "tenantId",
        "name",
        "contactInfo",
        "status"
      ]
    },
    "WhatsAppIntegration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WhatsAppIntegration",
      "type": "object",
      "description": "Represents a WhatsApp integration configuration for a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WhatsAppIntegration entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant this integration belongs to. (Relationship: Tenant 1:N WhatsAppIntegration)"
        },
        "apiKey": {
          "type": "string",
          "description": "The API key for the WhatsApp integration."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The phone number associated with the WhatsApp integration."
        }
      },
      "required": [
        "id",
        "tenantId",
        "apiKey",
        "phoneNumber"
      ]
    },
    "ChatbotAgent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatbotAgent",
      "type": "object",
      "description": "Represents a chatbot agent trained to handle conversations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChatbotAgent entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant this agent belongs to. (Relationship: Tenant 1:N ChatbotAgent)"
        },
        "name": {
          "type": "string",
          "description": "The name of the chatbot agent."
        },
        "trainingData": {
          "type": "string",
          "description": "The data used to train the chatbot agent; could be a reference to a file or stored text."
        }
      },
      "required": [
        "id",
        "tenantId",
        "name",
        "trainingData"
      ]
    },
    "Conversation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Conversation",
      "type": "object",
      "description": "Represents a conversation between a user and a chatbot agent.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Conversation entity."
        },
        "leadId": {
          "type": "string",
          "description": "Reference to the lead associated with this conversation. (Relationship: Lead 1:N Conversation)"
        },
        "agentId": {
          "type": "string",
          "description": "Reference to the ChatbotAgent handling the conversation. (Relationship: ChatbotAgent 1:N Conversation)"
        },
        "messages": {
          "type": "array",
          "description": "An array of message objects within the conversation.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "leadId",
        "agentId",
        "messages"
      ]
    },
    "RazorpayIntegration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RazorpayIntegration",
      "type": "object",
      "description": "Represents a Razorpay integration configuration for a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RazorpayIntegration entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant this integration belongs to. (Relationship: Tenant 1:N RazorpayIntegration)"
        },
        "apiKey": {
          "type": "string",
          "description": "The API key for the Razorpay integration."
        },
        "apiSecret": {
          "type": "string",
          "description": "The API secret for the Razorpay integration."
        }
      },
      "required": [
        "id",
        "tenantId",
        "apiKey",
        "apiSecret"
      ]
    },
    "MetaPixelIntegration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MetaPixelIntegration",
      "type": "object",
      "description": "Represents a Meta Pixel integration configuration for a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MetaPixelIntegration entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant this integration belongs to. (Relationship: Tenant 1:N MetaPixelIntegration)"
        },
        "pixelId": {
          "type": "string",
          "description": "The Pixel ID for the Meta Pixel integration."
        }
      },
      "required": [
        "id",
        "tenantId",
        "pixelId"
      ]
    },
    "AccountAccess": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AccountAccess",
      "type": "object",
      "description": "Represents the access control for leads based on user roles.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AccountAccess entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user this access is granted to. (Relationship: User 1:N AccountAccess)"
        },
        "leadId": {
          "type": "string",
          "description": "Reference to the lead this access pertains to. (Relationship: Lead 1:N AccountAccess)"
        },
        "canViewChat": {
          "type": "boolean",
          "description": "Indicates whether the user can view the chat associated with the lead."
        },
        "canEditLead": {
          "type": "boolean",
          "description": "Indicates whether the user can edit lead information."
        }
      },
      "required": [
        "id",
        "userId",
        "leadId",
        "canViewChat",
        "canEditLead"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/tenants/{tenantId}",
        "definition": {
          "entityName": "Tenant",
          "schema": {
            "$ref": "#/backend/entities/Tenant"
          },
          "description": "Stores tenant-specific data. Each tenant isolates data for different users or organizations.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier for the tenant."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. `tenantId` indicates which organization the user belongs to, enabling role-based access and data segregation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/leads/{leadId}",
        "definition": {
          "entityName": "Lead",
          "schema": {
            "$ref": "#/backend/entities/Lead"
          },
          "description": "Stores lead data, which is nested under a tenant to ensure data isolation.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier for the tenant."
            },
            {
              "name": "leadId",
              "description": "The unique identifier for the lead."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/chatbotAgents/{agentId}",
        "definition": {
          "entityName": "ChatbotAgent",
          "schema": {
            "$ref": "#/backend/entities/ChatbotAgent"
          },
          "description": "Stores ChatbotAgent data, segregated by tenant.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier for the tenant."
            },
            {
              "name": "agentId",
              "description": "The unique identifier for the chatbot agent."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/conversations/{conversationId}",
        "definition": {
          "entityName": "Conversation",
          "schema": {
            "$ref": "#/backend/entities/Conversation"
          },
          "description": "Stores conversation data, segregated by tenant.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier for the tenant."
            },
            {
              "name": "conversationId",
              "description": "The unique identifier for the conversation."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is built around a multi-tenant model to ensure data isolation between different organizations.\n\n*   **/tenants/{tenantId}**: This is the root for all tenant-specific information.\n*   **/users/{userId}**: This is a top-level collection for authentication purposes. Crucially, each user document contains a `tenantId` field, which is the cornerstone of our security rules. This allows us to quickly identify which tenant a user belongs to.\n*   **/tenants/{tenantId}/{collection}/{docId}**: All other business-critical data (leads, agents, conversations, etc.) is stored in subcollections under its respective tenant. This structure makes it impossible for a query to accidentally leak data from another tenant.\n\n**Security Rules Strategy:**\n\nThe rules are designed to enforce tenant boundaries strictly:\n1.  **User Access**: A user can only read their own user document or the documents of other users who share the same `tenantId`.\n2.  **Admin Privileges**: An 'Admin' role allows a user to update or delete other users within the *same tenant*.\n3.  **Subcollection Access**: All access to data within `/tenants/{tenantId}` subcollections is gated by checking if the requesting user's `tenantId` matches the `{tenantId}` in the path."
  }
}
    